import{createSlice}from"@reduxjs/toolkit";let initialUser=window.localStorage.getItem("user");initialUser=initialUser?JSON.parse(initialUser):{name:"",year:"",email:"",sex:"male",status:"manager",date:+new Date};let initialAnswers=window.localStorage.getItem("answers");initialAnswers=initialAnswers?JSON.parse(initialAnswers):{};const localSelected=JSON.parse(window.localStorage.getItem("selected"))||{},keysLocalSelected=Object.keys(localSelected),initialNeeds={},initialEmloyment=[0,0,0,0];keysLocalSelected.length>0&&keysLocalSelected.forEach((e=>{const[t,s]=e;initialEmloyment[t]||(initialEmloyment[t]=0),initialEmloyment[t]+=localSelected[e],initialNeeds[s]||(initialNeeds[s]=0),initialNeeds[s]+=localSelected[e]}));const initialEmploymentTitle=JSON.parse(window.localStorage.getItem("employmentTitle"))||[],initialState={user:initialUser,step:0,auth:!1,answers:initialAnswers,needs:initialNeeds,employment:initialEmloyment,employmentTitle:initialEmploymentTitle,selected:localSelected},userSlice=createSlice({name:"user",initialState,reducers:{setUser(e,{payload:t}){e.user={...t},e.auth=!0,localStorage.setItem("user",JSON.stringify(e.user))},setStep(e,{payload:t}){e.auth&&(e.step=t)},addAnswers(e,{payload:{id:t,module:s,val:l}}){e.answers[t]||(e.answers[t]={}),e.answers[t][s]||(e.answers[t][s]=[]),e.answers[t][s].includes(l)||e.answers[t][s].push(l),localStorage.setItem("answers",JSON.stringify(e.answers))},setNeeds(e,{payload:{title:t,value:s,id:l,count:i}}){e.needs[t]=s,e.selected[`${l[0]}${l[1]}`]=i,localStorage.setItem("selected",JSON.stringify(e.selected))},setEmpoyment(e,{payload:t}){e.employment=[...t]},setEmploymentTitle(e,{payload:{id:t,title:s}}){e.employmentTitle[t]=s,localStorage.setItem("employmentTitle",JSON.stringify(e.employmentTitle))},removeAnswers(e,{payload:{id:t,module:s,val:l}}){e.answers[t][s]=e.answers[t][s].filter((e=>e!==l)),0===e.answers[t][s].length&&delete e.answers[t][s],0===Object.keys(e.answers[t]).length&&delete e.answers[t],localStorage.setItem("answers",JSON.stringify(e.answers))}}});export const{setStep,setUser,addAnswers,removeAnswers,setNeeds,setEmpoyment,setEmploymentTitle}=userSlice.actions;export default userSlice.reducer;